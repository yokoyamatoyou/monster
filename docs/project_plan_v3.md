### プロジェクト計画書 v3.0：AI駆動型 患者プロファイリング＆コミュニケーション支援システム

1. プロジェクト目的と哲学
本プロジェクトの最終目標は、単なるリスク検知ツールの開発ではありません。AIを活用して患者の潜在的な心理的特性やコミュニケーションスタイルを深く理解し、医療従事者が一人ひとりに最適化された、より共感的で質の高いケアを提供するためのプロアクティブな支援システムを構築することです。

根本哲学:
このシステムは、患者に「モンスターペイシェント」というレッテルを貼るためのものでは断じてありません。むしろ、医療従事者が患者の言動の背景にある不安や期待を察知し、信頼関係の構築を促進するための**「コミュニケーションの地図」**として機能することを絶対的な前提とします。したがって、すべての機能設計とAIへの指示は、このケアの質を向上させるという目的に沿って行われなければなりません。

2. LLMへの指示体系：システムの頭脳の設計
AIの出力を安定的かつ目的に沿ったものにするため、以下の厳格な指示体系を定義します。

2.1. 5軸の定義とスコアリング
レーダーチャートの項目となる5つの検知軸を以下のように定義します。

軸1：特権意識と期待 (Entitlement & Expectation): 特別な扱い、結果の保証、即時対応を求める傾向。
軸2：情動の不安定性 (Emotional Volatility): ストレス下での感情の揺れ動きやすさ、衝動性。
軸3：不信感と猜疑心 (Distrust & Suspicion): 他者の意図を疑い、情報を自己検証しようとする傾向。
軸4：依存性と操作性 (Dependency & Manipulation): 他者からの過剰な安心感を求め、感情に訴えかける傾向。
軸5：統制欲求と完璧主義 (Control & Perfectionism): 曖昧さを嫌い、計画通りに進めることを強く求める傾向。
スコア範囲: 各軸 1.0 (低) 〜 5.0 (高)
計算方法: 各質問は5段階のリッカート尺度で回答。各軸に紐づく質問の回答スコア（1〜5）の平均値をその軸のスコアとする。

2.2. 質問生成AI (GPT-4.1) への指示
背景知識: 先行研究で特定した心理的特性、特にSAPAS やMSI-BPD の質問スタイル（非臨床的で一般的な問いかけ）を模倣するよう指示。
温度設定 (Temperature): 創造性と多様性を確保しつつ、意味的重複を避けるため、温度設定は段階的に変更する。初期はtemperature=0.4で安定した質問を生成し、0.02ごと上昇させ0.8まで引き上げ、多様な表現の質問を獲得する。
出力形式の安定性: 出力は必ずJSON形式とし、{"question_text": "（生成された質問文）", "axis": "（対応する軸の名称）"} の形式を遵守させることで、後の処理の安定性を確保する。

2.3. 分析・フィードバック生成AI (GPT-4.1) への指示
背景知識: 5軸の定義、各軸の高スコアが示唆する行動パターン、および推奨されるコミュニケーション戦略を知識ベースとしてプロンプトに組み込む。
温度設定 (Temperature): temperatureは0.1以下に厳格に設定し、分析結果の再現性と安定性を最優先する。
患者向けフィードバックの指示:
体裁: 「診療方針に関するご確認」
AIの役割: 「共感的で、安心感を与え、治療への協力を促すカウンセラー」
指示内容: リスクを指摘するのではなく、患者の回答から読み取れる**「大切にしていること」や「価値観」**を肯定的に言語化する。
医療従事者向けフィードバックの指示:
体裁: 「コミュニケーション支援レポート」
AIの役割: 「経験豊富な臨床心理士兼リスクマネージャー」
指示内容: 具体的で実行可能な形式とする。{"risk_profile_summary": "（レーダーチャートの形状から読み取れる全体的な傾向）", "caution_points": ["（避けるべき対応や言動の具体例）"], "recommended_actions": ["（推奨される対応や声かけの具体例）"], "escalation_plan": "（迷惑行為に発展した場合の段階的対応策）"} の厳格なJSON形式で出力させる。

3. GUIデザインコンセプト
コンセプト: 「Clinical Clean & Calm（臨床的な清潔感と落ち着き）」
配色: ホワイト(FFFFFF)を基調に、アクセントカラーは信頼感のある落ち着いた青 (4A90E2)。テキストはダークグレー (4A4A4A)。
フォント: Noto Sans JP (Thin/Light) を使用し、細身でモダンな印象に。
アイコン: イラストは使用せず、単色の線で描かれたピクトグラムを使用。ファビコンは聴診器とハートの線画を組み合わせたものを設定する。

4. 開発フェーズ別 詳細指示書
フェーズ1: 基盤構築とAIプロンプトエンジニアリング
タスク1.1: 環境設定とGUIデザインコンセプトの適用
Streamlit, Pandas, OpenAIライブラリを含むrequirements.txtを作成。カスタムCSSとfaviconを設定。
タスク1.2: LLM指示体系の実装（プロンプト設計と実装）
A) 質問生成プロンプト
B) 患者向けフィードバックプロンプト
C) 医療従事者向けフィードバックプロンプト
タスク1.3: データ永続化モジュールの実装
/dataディレクトリを作成し、指定された構造でCSVに保存する関数を実装する。

フェーズ2: アプリケーションコア機能の実装
タスク2.1: アンケート生成・実施機能の実装
タスク2.2: スコアリングとレーダーチャート可視化の実装
タスク2.3: AI連携によるフィードバック生成機能の実装

フェーズ3: UI/UX実装と統合
タスク3.1: StreamlitによるUI全体の構築
タスク3.2: 患者向け画面フローの実装
タスク3.3: 医療従事者向け画面フローの実装

フェーズ4: テスト、倫理的レビュー、デプロイ準備
タスク4.1: 機能テストと出力安定性検証
タスク4.2: 倫理的実装の最終レビュー
タスク4.3: ドキュメントとデプロイ準備
